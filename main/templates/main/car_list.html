<!-- main/templates/main/car_list.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê—Ä–µ–Ω–¥–∞ –∞–≤—Ç–æ | –ì–ª–∞–≤–Ω–∞—è</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900">

<header class="bg-white shadow-md p-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold">üöó RentAuto</h1>
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button class="text-blue-500 hover:underline">–í—ã–π—Ç–∏</button>
    </form>
</header>

<section class="p-6 bg-white shadow mt-4 max-w-5xl mx-auto rounded-xl">
    <form method="GET" class="flex flex-wrap gap-4 items-end">
        <div>
            <label class="block font-semibold">–ö–ª–∞—Å—Å –∞–≤—Ç–æ</label>
            <select name="category" class="border rounded p-2">
                <option value="">–í—Å–µ</option>
                <option value="standard" {% if category == 'standard' %}selected{% endif %}>–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                <option value="luxury" {% if category == 'luxury' %}selected{% endif %}>–õ—é–∫—Å</option>
                <option value="electric" {% if category == 'electric' %}selected{% endif %}>–≠–ª–µ–∫—Ç—Ä–æ</option>
            </select>
        </div>

        <div>
            <label class="block font-semibold">–î–∞—Ç–∞ –æ—Ç</label>
            <input type="date" name="start_date" value="{{ start_date }}" class="border rounded p-2">
        </div>

        <div>
            <label class="block font-semibold">–î–∞—Ç–∞ –¥–æ</label>
            <input type="date" name="end_date" value="{{ end_date }}" class="border rounded p-2">
        </div>

        <div>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">üîç –ù–∞–π—Ç–∏</button>
        </div>
    </form>
</section>

<section class="max-w-5xl mx-auto mt-6">
    {% if cars %}
    <div class="grid md:grid-cols-2 gap-6">
        {% for car in cars %}
        <div class="bg-white shadow p-4 rounded-xl">
            <h2 class="text-xl font-bold mb-2">{{ car.brand }} {{ car.model }}</h2>
            {% if car.image %}
            <img src="{{ car.image.url }}" alt="{{ car.brand }}" class="w-full h-48 object-cover rounded">
            {% endif %}
            <p class="mt-2">üí∞ <strong>{{ car.price_per_day }} ‚Ç∏</strong> –≤ –¥–µ–Ω—å</p>
            <p>üöò –ö–ª–∞—Å—Å: {{ car.get_category_display }}</p>
            <p>{% if car.is_available %}‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞{% else %}‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞{% endif %}</p>
            <p>‚≠ê –†–µ–π—Ç–∏–Ω–≥: {{ car.reviews_avg|floatformat:1 }}/5 ({{ car.reviews.count }} –æ—Ç–∑—ã–≤–æ–≤)</p>

            <!-- –í—ã–≤–æ–¥ –æ—Ç–∑—ã–≤–æ–≤ -->
            <div class="mt-4">
                <h3 class="font-semibold mb-2">–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤:</h3>
                {% if car.reviews.all %}
                    <div class="space-y-2 max-h-48 overflow-y-auto">
                        {% for review in car.reviews.all %}
                        <div class="border p-2 rounded bg-gray-50">
                            <!-- –†–µ–π—Ç–∏–Ω–≥ –∑–≤–µ–∑–¥–∞–º–∏ -->
                            <div class="flex items-center mb-1">
                                <span class="text-yellow-500">
                                    {% for i in review.stars_full %}
                                        ‚òÖ
                                    {% endfor %}
                                    {% for i in review.stars_empty %}
                                        ‚òÜ
                                    {% endfor %}
                                </span>
                                <span class="ml-1 font-semibold">{{ review.rating }}/5</span>
                                <span class="ml-2 text-gray-400 text-sm">{{ review.created_at|date:"d.m.Y" }}</span>
                            </div>
                            <p class="text-gray-700">{{ review.comment }}</p>
                            <p class="text-gray-500 text-sm">–û—Ç: {{ review.user.username }}</p> <!-- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-400">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤.</p>
                {% endif %}
            </div>

            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞ -->
            <form method="POST" class="mt-4">
                {% csrf_token %}
                <input type="hidden" name="car_id" value="{{ car.id }}">
                <div>
                    <label class="block">–û—Ü–µ–Ω–∫–∞ (1‚Äì5)</label>
                    <select name="rating" class="border rounded p-2 w-full">
                        {% for i in "12345" %}
                        <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mt-2">
                    <label class="block">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea name="comment" rows="3" class="border rounded p-2 w-full" placeholder="–í–∞—à –æ—Ç–∑—ã–≤..."></textarea>
                </div>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded mt-2">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
            </form>

            <a href="{% url 'booking' car.id %}" class="inline-block bg-green-600 text-white px-4 py-2 rounded mt-4">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-gray-500 mt-6">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—à–∏–Ω –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</p>
    {% endif %}
</section>

<footer class="text-center text-sm text-gray-500 mt-10 p-4">
    &copy; {{ year }} RentAuto. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
</footer>

</body>
</html>
